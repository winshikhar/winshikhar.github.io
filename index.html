<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dr. Shikhar Bhardwaj â€” Portfolio & CV</title>
  <meta name="description" content="Dr. Shikhar Bhardwaj â€” AI, ML, GenAI Engineer, IoT & SDN Research, Publications, and interactive projects." />
  <!-- Print stylesheet -->
  <style media="print">
    * { 
      -webkit-print-color-adjust: exact !important;
      color-adjust: exact !important;
      box-shadow: none !important;
      text-shadow: none !important;
    }
    body {
      background: white !important;
      color: black !important;
    }
    .card, .container, header, footer, .tab, .chip, .dice, .roll, .acc-h, .acc-panel, canvas {
      background: white !important;
      border: 1px solid #ccc !important;
      color: black !important;
    }
    .muted, .contact, .tagline, .skills, ul, .chip, .acc-panel {
      color: #555 !important;
    }
    a { color: #007bff !important; text-decoration: underline !important; }
    canvas, .knfl .playground, .knfl .roll, .knfl .score, #instructionPrompt {
      display: none !important;
    }
    .tabs { display: none; }
    [role="tabpanel"] { display: block !important; }
    #panel-home, #panel-ai, #panel-ml, #panel-genai, #panel-pubs { display: block !important; page-break-after: always; }
    .contact a { word-break: break-all; }
  </style>
  <!-- Tailwind-like minimal utility CSS (self-contained) -->
  <style id="themeStyles">
    :root {
      --bg: #0f1724;
      --panel: #0b1220;
      --muted: #94a3b8;
      --card: #071025;
      --accent: #7c3aed;
      --accent-2: #06b6d4;
      --glass: rgba(255,255,255,0.03);
      --radius: 12px;
      --maxwidth: 1100px;
      --mono: Inter, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      --bp-md: 920px;
    }
    [data-theme="light"] {
      --bg: #ffffff;
      --panel: #f8fafc;
      --muted: #64748b;
      --card: #f1f5f9;
      --glass: rgba(0,0,0,0.03);
      --accent: #7c3aed;
      --accent-2: #06b6d4;
      color-scheme: light;
    }
    * { box-sizing: border-box; }
    html, body {
      height: 100%;
      margin: 0;
      font-family: var(--mono);
      background: linear-gradient(180deg, var(--bg) 0%, var(--panel) 60%);
      color: var(--text-color, #e6eef6);
    }
    [data-theme="light"] body {
      background: linear-gradient(180deg, #ffffff 0%, #f8fafc 60%);
      color: #1e293b;
    }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }
    .container { max-width: var(--maxwidth); margin: 20px auto; padding: 20px; }
    header {
      display: flex;
      gap: 20px;
      align-items: center;
      flex-wrap: wrap;
      position: relative;
    }
    .brand {
      font-weight: 700;
      font-size: 1.6rem;
      color: var(--accent);
      letter-spacing: 0.2px;
    }
    .tagline { color: var(--muted); font-size: 0.95rem; }
    .contact {
      margin-left: auto;
      text-align: right;
      color: var(--muted);
      font-size: 0.9rem;
    }
    .theme-toggle {
      position: absolute;
      top: 0;
      right: 0;
      background: var(--glass);
      border: 1px solid rgba(255,255,255,0.04);
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: var(--muted);
      font-size: 14px;
    }
    [data-theme="light"] .theme-toggle {
      color: #64748b;
      background: rgba(0,0,0,0.03);
      border-color: rgba(0,0,0,0.1);
    }
    .tabs {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 18px;
    }
    .tab {
      background: var(--glass);
      border: 1px solid rgba(255,255,255,0.04);
      padding: 8px 12px;
      border-radius: 10px;
      color: var(--muted);
      cursor: pointer;
      white-space: nowrap;
    }
    [data-theme="light"] .tab {
      background: rgba(0,0,0,0.02);
      border-color: rgba(0,0,0,0.1);
      color: #64748b;
    }
    .tab[aria-selected="true"] {
      background: linear-gradient(180deg, rgba(124,58,237,0.12), rgba(6,182,212,0.06));
      color: #fff;
      box-shadow: 0 6px 28px rgba(2,6,23,0.6);
      border-color: rgba(124,58,237,0.35);
    }
    [data-theme="light"] .tab[aria-selected="true"] {
      color: #1e293b;
      background: linear-gradient(180deg, rgba(124,58,237,0.08), rgba(6,182,212,0.04));
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      border-color: rgba(124,58,237,0.4);
    }
    main.card {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.015));
      border-radius: var(--radius);
      padding: 20px;
      margin-top: 18px;
      box-shadow: 0 8px 40px rgba(2,6,23,0.6);
    }
    [data-theme="light"] main.card {
      background: linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.4));
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      color: #1e293b;
    }
    h1, h2, h3 {
      margin: 0 0 8px 0;
      color: var(--text-color, #e6eef6);
    }
    [data-theme="light"] h1, [data-theme="light"] h2, [data-theme="light"] h3 {
      color: #0f172a;
    }
    .muted { color: var(--muted); }
    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 320px;
      gap: 18px;
    }
    @media (max-width: var(--bp-md)) {
      .grid-2 { grid-template-columns: 1fr; }
    }
    ul {
      margin: 8px 0 12px 18px;
      color: #dbeafe;
    }
    [data-theme="light"] ul { color: #475569; }
    .skills {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 8px 0;
    }
    .chip {
      background: rgba(255,255,255,0.02);
      padding: 6px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.02);
      font-size: 0.85rem;
    }
    [data-theme="light"] .chip {
      background: rgba(0,0,0,0.03);
      border-color: rgba(0,0,0,0.05);
      color: #475569;
    }
    .knfl .playground {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }
    .knfl .dice {
      width: 48px;
      height: 48px;
      border-radius: 8px;
      background: #fff;
      color: #111;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      border: 2px solid rgba(0,0,0,0.06);
    }
    .knfl .roll {
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      color: white;
      padding: 10px 14px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      font-weight: 700;
    }
    .knfl .score {
      margin-top: 12px;
      color: #e2f0ff;
    }
    [data-theme="light"] .knfl .score { color: #1e293b; }
    .accordion {
      margin-top: 12px;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.03);
    }
    [data-theme="light"] .accordion {
      border-color: rgba(0,0,0,0.1);
    }
    .acc-item { border-bottom: 1px solid rgba(255,255,255,0.02); }
    [data-theme="light"] .acc-item { border-bottom-color: rgba(0,0,0,0.05); }
    .acc-h {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 14px;
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
    }
    [data-theme="light"] .acc-h {
      background: linear-gradient(180deg, rgba(0,0,0,0.01), rgba(0,0,0,0.005));
    }
    .acc-title { font-weight: 600; }
    .acc-btn {
      background: none;
      border: none;
      color: var(--muted);
      font-weight: 700;
      cursor: pointer;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .acc-panel {
      padding: 12px 14px;
      background: transparent;
      color: #cfe8ff;
      display: none;
    }
    [data-theme="light"] .acc-panel { color: #475569; }
    .acc-panel.show { display: block; }
    #gameCanvas {
      width: 100%;
      height: 60vh;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.02);
    }
    [data-theme="light"] #gameCanvas {
      border-color: rgba(0,0,0,0.1);
    }
    footer {
      margin-top: 14px;
      color: var(--muted);
      font-size: 0.9rem;
    }
    .tab:focus,
    .acc-btn:focus,
    .knfl .roll:focus {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <div class="container" id="app">
    <header>
      <div>
        <div class="brand">Dr. Shikhar Bhardwaj</div>
        <div class="tagline">PhD Â· AI / ML / GenAI Engineer Â· IoT & SDN Research</div>
      </div>
      <div class="contact">
        Noida, India<br/>
        <a href="mailto:winshikhar@gmail.com">winshikhar@gmail.com</a><br/>
        <a href="https://linkedin.com/in/b-shikhar/" target="_blank" rel="noopener noreferrer">linkedin.com/in/b-shikhar</a>
      </div>
      <button class="theme-toggle" id="themeToggle" aria-label="Toggle light/dark mode">ðŸŒ“</button>
    </header>

    <!-- Tabs -->
    <nav class="tabs" role="tablist" aria-label="Primary">
      <button class="tab" role="tab" aria-selected="true" aria-controls="panel-home" id="tab-home" data-target="panel-home" type="button">Home</button>
      <button class="tab" role="tab" aria-selected="false" aria-controls="panel-ai" id="tab-ai" data-target="panel-ai" type="button">AI Engineer</button>
      <button class="tab" role="tab" aria-selected="false" aria-controls="panel-ml" id="tab-ml" data-target="panel-ml" type="button">ML Engineer</button>
      <button class="tab" role="tab" aria-selected="false" aria-controls="panel-genai" id="tab-genai" data-target="panel-genai" type="button">GenAI Engineer</button>
      <button class="tab" role="tab" aria-selected="false" aria-controls="panel-pubs" id="tab-pubs" data-target="panel-pubs" type="button">Publications</button>
      <button class="tab" role="tab" aria-selected="false" aria-controls="panel-knfl" id="tab-knfl" data-target="panel-knfl" type="button">KNFL (Game)</button>
      <button class="tab" role="tab" aria-selected="false" aria-controls="panel-play" id="tab-play" data-target="panel-play" type="button">Playground</button>
    </nav>

    <main class="card" id="mainCard">
      <!-- HOME PANEL -->
      <section id="panel-home" role="tabpanel" aria-labelledby="tab-home" tabindex="0">
        <div class="grid-2">
          <div>
            <h2>Professional summary</h2>
            <p class="muted">6+ years of AI/ML & IoT research and production engineering. On-prem GenAI deployments, MLOps, edge ML, SDN/IoT architectures, and academic publications.</p>

            <h3>Key achievements</h3>
            <ul>
              <li>On-prem LLM inference engine (vLLM/Flask) â€” cut LLM expenses ~50% and reduced latency ~40%.</li>
              <li>RAG document chatbots with guardrails and vector DB integration (ChromaDB/pgvector).</li>
              <li>SCIE publications on consumer-centric CDN for IoT and verified privacy analyses.</li>
            </ul>

            <h3>Skills</h3>
            <div class="skills">
              <span class="chip">Python</span><span class="chip">TensorFlow</span><span class="chip">PyTorch</span>
              <span class="chip">Docker</span><span class="chip">Kubernetes</span><span class="chip">vLLM</span>
              <span class="chip">Whisper</span><span class="chip">Neo4j</span><span class="chip">MQTT</span>
            </div>
          </div>

          <aside style="padding:12px;background:var(--glass);border-radius:10px">
            <h3 class="muted">Quick actions</h3>
            <p class="muted">Use the tabs above to explore role-specific CVs, publications, or interactive projects.</p>
          </aside>
        </div>
      </section>

      <!-- AI PANEL -->
      <section id="panel-ai" role="tabpanel" aria-labelledby="tab-ai" hidden tabindex="0">
        <h2>AI Engineer â€” ATS-optimised</h2>
        <p class="muted">Focus: production ML systems, inference engineering, MLOps, and edge integration.</p>

        <h3>Experience (selected)</h3>
        <h4>Deputy Manager, Advanced Technology Group â€” DS Group (Jan 2024 â€” Present)</h4>
        <ul>
          <li>Built on-prem LLM inference engine (vLLM, Flask, Docker) for sales & finance â€” reduced third-party LLM costs by 50% and improved inference latency by ~40%.</li>
          <li>Document chatbot with RAG (ChromaDB/pgvector), OpenAI streaming APIs, and containerised prompt-guardrails.</li>
          <li>Integrated Whisper for STT/TTS and Neo4j for relationship queries; packaged PoC using Gradio.</li>
        </ul>
      </section>

      <!-- ML PANEL -->
      <section id="panel-ml" role="tabpanel" aria-labelledby="tab-ml" hidden tabindex="0">
        <h2>ML Engineer â€” ATS-optimised</h2>
        <p class="muted">Focus: model development, evaluation, deployment, MLOps and edge ML.</p>

        <h3>Highlights</h3>
        <ul>
          <li>Optimised inference pipelines with quantization/pruning to reduce memory & latency up to 50% for edge deployments.</li>
          <li>Implemented CI/CD for model lifecycles (Docker, Jenkins), reducing release time.</li>
          <li>Deployed transfer learning and ensemble models on Raspberry Pi / Jetson for real-time inference.</li>
        </ul>
      </section>

      <!-- GENAI PANEL -->
      <section id="panel-genai" role="tabpanel" aria-labelledby="tab-genai" hidden tabindex="0">
        <h2>GenAI Engineer â€” ATS-optimised</h2>
        <p class="muted">Focus: LLM infra, RAG systems, on-prem inference, prompt safety and agentic workflows.</p>

        <h3>Selected work</h3>
        <ul>
          <li>Hybrid rule + LLM inference architecture (vLLM / ollama) that routes between local models and streaming OpenAI to cut costs by ~50%.</li>
          <li>RAG with ChromaDB/pgvector and containerised guardrails to protect against injection/jailbreaks.</li>
          <li>Real-time voice interfaces with Whisper STT/TTS.</li>
        </ul>
      </section>

      <!-- PUBLICATIONS PANEL -->
      <section id="panel-pubs" role="tabpanel" aria-labelledby="tab-pubs" hidden tabindex="0">
        <h2>Publications</h2>
        <p class="muted">Peer-reviewed research in IoT, SDN, privacy, and secure communications.</p>
        <div class="accordion" id="pubs-accordion"></div>
      </section>

      <!-- KNFL GAME PANEL -->
      <section id="panel-knfl" role="tabpanel" aria-labelledby="tab-knfl" hidden tabindex="0">
        <h2>KNFL â€” Dice Game</h2>
        <p class="muted">Roll five dice. Special hands: KNFL (all same), little/big street (4/5 consecutive), fullhouse, or stacks.</p>

        <div class="knfl">
          <div class="playground" id="knfl-dice" aria-live="polite"></div>
          <div style="margin-top:12px">
            <button class="knfl roll" id="knfl-roll" type="button">Roll</button>
            <div class="score" id="knfl-score" aria-atomic="true"></div>
          </div>
          <div style="margin-top:12px;color:var(--muted);font-size:0.9rem">Tip: KNFL yields 500 pts â€” it is rare but accumulates across plays.</div>
        </div>
      </section>

      <!-- PLAYGROUND PANEL -->
      <section id="panel-play" role="tabpanel" aria-labelledby="tab-play" hidden tabindex="0">
        <h2>Interactive Playground</h2>
        <p class="muted">Move the mouse to create animated shapes. Click and hold to alter dynamics.</p>
        <canvas id="gameCanvas" aria-label="interactive canvas playground"></canvas>
        <div id="instructionPrompt" style="display:none;margin-top:10px;color:var(--muted)">Move your mouse to spawn shapes. Click & hold to change behaviour.</div>
      </section>
    </main>

    <!-- Footer removed: no content -->
  </div>

  <script>
  (function(){
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    /* THEME TOGGLE */
    const themeToggle = $('#themeToggle');
    const root = document.documentElement;
    const systemPrefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    let currentTheme = localStorage.getItem('theme') || (systemPrefersDark ? 'dark' : 'light');
    root.setAttribute('data-theme', currentTheme);
    themeToggle.textContent = currentTheme === 'light' ? 'ðŸŒ™' : 'ðŸŒ“';
    themeToggle.addEventListener('click', () => {
      currentTheme = currentTheme === 'light' ? 'dark' : 'light';
      root.setAttribute('data-theme', currentTheme);
      localStorage.setItem('theme', currentTheme);
      themeToggle.textContent = currentTheme === 'light' ? 'ðŸŒ™' : 'ðŸŒ“';
    });

    /* TABS */
    const tabs = $$('[role="tab"]');
    const panels = $$('[role="tabpanel"]');

    function activateTabButton(tabBtn){
      if(!tabBtn) return;
      tabs.forEach(t => t.setAttribute('aria-selected','false'));
      panels.forEach(p => p.hidden = true);
      tabBtn.setAttribute('aria-selected','true');
      const targetId = tabBtn.getAttribute('data-target') || tabBtn.getAttribute('aria-controls');
      const panel = document.getElementById(targetId);
      if(panel){
        panel.hidden = false;
        panel.focus();
      }
    }

    const tablist = $('.tabs');
    if(tablist){
      tablist.addEventListener('click', (ev) => {
        const btn = ev.target.closest('[role="tab"]');
        if(btn) activateTabButton(btn);
      });

      tablist.addEventListener('keydown', (ev) => {
        const btn = ev.target.closest('[role="tab"]');
        if(!btn) return;
        let idx = tabs.indexOf(btn);
        if(ev.key === 'ArrowRight'){ idx = (idx + 1) % tabs.length; tabs[idx].focus(); ev.preventDefault(); }
        if(ev.key === 'ArrowLeft'){ idx = (idx - 1 + tabs.length) % tabs.length; tabs[idx].focus(); ev.preventDefault(); }
        if(ev.key === 'Home'){ tabs[0].focus(); ev.preventDefault(); }
        if(ev.key === 'End'){ tabs[tabs.length-1].focus(); ev.preventDefault(); }
        if(ev.key === 'Enter' || ev.key === ' '){ activateTabButton(btn); ev.preventDefault(); }
      });
    }

    window.activateTabById = function(tabId){
      const b = document.getElementById(tabId);
      if(b) activateTabButton(b);
    };

    const initial = $('.tab[aria-selected="true"]') || tabs[0];
    activateTabButton(initial);

    /* PUBLICATIONS â€” ONLY IN PUBLICATIONS TAB */
    const publications = [
      {
        title: "There is Mathematics for That! : A Formal Verification of Privacy and Simulative Analysis of Consumer-Centric Content Delivery in IoT",
        authors: "Shikhar Bhardwaj, Sandeep Harit, Shilpa",
        year: 2025,
        venue: "Transactions on Emerging Telecommunications Technologies (SCIE)",
        url: "https://onlinelibrary.wiley.com/doi/10.1002/ett.70059"
      },
      {
        title: "Towards a software-defined networking model for consumer-centric content delivery network for IoT",
        authors: "Shikhar Bhardwaj, Sandeep Harit, Anil Yadav",
        year: 2023,
        venue: "Transactions on Emerging Telecommunications Technologies (SCIE)",
        url: "https://onlinelibrary.wiley.com/doi/abs/10.1002/ett.4903"
      },
      {
        title: "Message Queuing Telemetry Transport - Secure Connection: A Power-efficient Secure Communication",
        authors: "Shikhar Bhardwaj, Sandeep Harit, Shilpa, Darpan Anand",
        year: 2023,
        venue: "International Journal of Sensor Networks (IJSN SCIE)",
        url: "https://doi.org/10.1504/IJSNET.2023.131246"
      },
      {
        title: "SDN-Enabled Secure IoT Architecture Development: A Review",
        authors: "Bhardwaj S., Harit S.",
        year: 2022,
        venue: "Inventive Communication and Computational Technologies (ICICCT). Lecture Notes in Networks and Systems, vol 311. Springer",
        url: "https://doi.org/10.1007/978-981-16-5529-6_47"
      },
      {
        title: "Traceability of Unwitting Disclosure Using Explainable Correlation in Procurement and Supply Chain",
        authors: "Gunjal, H.V.; Ingale, V.; Bhardwaj, S.; Belokar, R.M.",
        year: 2023,
        venue: "Applications of Emerging Technologies and AI/ML Algorithms. ICDAPS 2022. Asset Analytics. Springer",
        url: "https://doi.org/10.1007/978-981-99-1019-9_35"
      },
      {
        title: "Stacking Ensemble-based Automatic Web Page Classification",
        authors: "D. Deeksha, R. Bhatia, S. Bhardwaj, M. Kumar, K. Bhatia and S. S. Gill",
        year: 2021,
        venue: "Fourth International Conference on Computational Intelligence and Communication Technologies (CCICT), IEEE",
        url: "https://doi.org/10.1109/CCICT53244.2021.00042"
      }
    ].map(pub => ({ ...pub, url: pub.url.trim() }));

    function buildPublicationsAccordion(){
      const wrapper = $('#pubs-accordion');
      if(!wrapper || wrapper.children.length > 0) return;

      publications.forEach((p, idx) => {
        const item = document.createElement('div');
        item.className = 'acc-item';
        const header = document.createElement('div');
        header.className = 'acc-h';
        const title = document.createElement('div');
        title.className = 'acc-title';
        title.textContent = `${p.authors} â€” ${p.title} (${p.year})`;
        const btn = document.createElement('button');
        btn.className = 'acc-btn';
        btn.setAttribute('aria-expanded','false');
        btn.setAttribute('aria-controls', `acc-panel-${idx}`);
        btn.type = 'button';
        btn.textContent = '+';

        const panel = document.createElement('div');
        panel.className = 'acc-panel';
        panel.id = `acc-panel-${idx}`;
        panel.setAttribute('role','region');
        panel.setAttribute('aria-hidden','true');

        const venueDiv = document.createElement('div');
        venueDiv.innerHTML = `<strong>Venue:</strong> ${p.venue}`;
        const link = document.createElement('a');
        link.href = p.url;
        link.target = '_blank';
        link.rel = 'noopener noreferrer';
        link.textContent = 'View publication';
        const linkDiv = document.createElement('div');
        linkDiv.style.marginTop = '6px';
        linkDiv.appendChild(link);

        panel.appendChild(venueDiv);
        panel.appendChild(linkDiv);

        btn.addEventListener('click', () => {
          const expanded = btn.getAttribute('aria-expanded') === 'true';
          const newState = !expanded;
          btn.setAttribute('aria-expanded', String(newState));
          panel.classList.toggle('show', newState);
          panel.setAttribute('aria-hidden', String(!newState));
          btn.textContent = newState ? 'â€“' : '+';
        });

        header.appendChild(title);
        header.appendChild(btn);
        item.appendChild(header);
        item.appendChild(panel);
        wrapper.appendChild(item);
      });
    }

    // Build pubs only when Publications tab is activated
    $('#tab-pubs').addEventListener('click', buildPublicationsAccordion);
    $('#tab-pubs').addEventListener('keydown', (e) => { if(e.key === 'Enter') buildPublicationsAccordion(); });

    /* KNFL GAME (unchanged logic, fixed) */
    (function initKnfl(){
      const roll = $('#knfl-roll');
      const diceHolder = $('#knfl-dice');
      const scoreBox = $('#knfl-score');
      if(!roll || !diceHolder || !scoreBox) return;

      const DICE_COUNT = 5;
      const SCORES = { KNFL: 500, BIG_STREET: 40, LIL_STREET: 30, FULLHOUSE: 25 };
      let totalPlays = 0, totalHighWins = 0, totalPoints = 0;

      function renderDice(arr){
        diceHolder.innerHTML = '';
        arr.forEach(n => {
          const d = document.createElement('div');
          d.className = 'dice';
          d.textContent = n;
          diceHolder.appendChild(d);
        });
      }

      function evaluate(arr){
        const sorted = [...arr].sort((a,b)=>a-b);
        const unique = [...new Set(sorted)];
        const isKNFL = sorted.every(v => v === sorted[0]);

        let maxStreet = 1, current = 1;
        for (let i = 1; i < unique.length; i++) {
          if (unique[i] === unique[i-1] + 1) {
            current++;
            maxStreet = Math.max(maxStreet, current);
          } else {
            current = 1;
          }
        }
        const isBig = maxStreet >= 5;
        const isLil = maxStreet >= 4 && !isBig;

        const counts = {};
        sorted.forEach(v => counts[v] = (counts[v] || 0) + 1);
        const freqs = Object.values(counts).sort((a,b)=>b-a);
        const isFullhouse = freqs.length === 2 && freqs[0] === 3 && freqs[1] === 2;

        let winText = 'Stack', winPoints = 0;
        if (isKNFL) {
          winText = 'KNFL';
          winPoints = SCORES.KNFL;
          totalHighWins++;
        } else if (isBig) {
          winText = 'Big street';
          winPoints = SCORES.BIG_STREET;
        } else if (isLil) {
          winText = "Lil' street";
          winPoints = SCORES.LIL_STREET;
        } else if (isFullhouse) {
          winText = 'Fullhouse';
          winPoints = SCORES.FULLHOUSE;
        } else {
          const bestValue = sorted.reduce((a, b) => counts[a] > counts[b] ? a : b);
          winPoints = bestValue * counts[bestValue];
          winText = `Stack (${counts[bestValue]}) of ${bestValue}`;
        }

        totalPoints += winPoints;
        totalPlays++;
        const pct = totalPlays ? Math.ceil(100 * totalHighWins / totalPlays) + '%' : '0%';
        return { winText, winPoints, totalPoints, totalPlays, pct };
      }

      roll.addEventListener('click', ()=>{
        const arr = Array.from({length: DICE_COUNT}, () => Math.floor(Math.random()*6)+1);
        renderDice(arr);
        const res = evaluate(arr);
        scoreBox.innerHTML = `Current: ${res.winText} (${res.winPoints} pts) â€” Total: ${res.totalPoints} pts | Plays: ${res.totalPlays} | KNFL %: ${res.pct}`;
      });
    })();

    /* PLAYGROUND */
    let playgroundInitialized = false;
    function initPlayground(){
      if(playgroundInitialized) return;
      playgroundInitialized = true;
      const canvas = $('#gameCanvas');
      const prompt = $('#instructionPrompt');
      if(!canvas) return;

      function fitCanvas(){
        const dpr = window.devicePixelRatio || 1;
        const vh = window.innerHeight * 0.6;
        canvas.width = vh * dpr;
        canvas.height = vh * dpr;
        canvas.style.height = vh + 'px';
        canvas.style.width = '100%';
        const ctx = canvas.getContext('2d');
        ctx.scale(dpr, dpr);
        return ctx;
      }

      let ctx = fitCanvas();
      window.addEventListener('resize', () => { ctx = fitCanvas(); });

      let shapes = [], colourAngle = 0;
      const rand = (min, max) => min + Math.random() * (max - min);

      function createShape(x, y){
        shapes.push({
          x, y,
          rad: rand(8, 40),
          vel: { x: rand(-3, 3), y: rand(-2, 6) },
          col: {
            r: Math.floor(128 + 100 * Math.sin(colourAngle)),
            g: Math.floor(128 + 100 * Math.cos(colourAngle)),
            b: Math.floor(128 - 100 * Math.sin(colourAngle))
          },
          alpha: 1
        });
        colourAngle += 0.08;
      }

      function draw(){
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        for (let i = shapes.length - 1; i >= 0; i--) {
          const s = shapes[i];
          ctx.beginPath();
          ctx.fillStyle = `rgba(${s.col.r},${s.col.g},${s.col.b},${s.alpha})`;
          ctx.arc(s.x, s.y, s.rad, 0, Math.PI * 2);
          ctx.fill();
          s.x += s.vel.x;
          s.y += s.vel.y;
          s.alpha *= 0.995;
          if (s.alpha < 0.02) shapes.splice(i, 1);
        }
        requestAnimationFrame(draw);
      }

      canvas.addEventListener('mousemove', (e) => {
        const rect = canvas.getBoundingClientRect();
        if (Math.random() > 0.6) createShape(e.clientX - rect.left, e.clientY - rect.top);
      });

      canvas.addEventListener('mousedown', () => {});
      window.addEventListener('mouseup', () => {});

      if (prompt) {
        prompt.style.display = 'block';
        prompt.style.opacity = '1';
      }

      draw();
    }

    $('#tab-play').addEventListener('click', initPlayground);
    $('#tab-play').addEventListener('keydown', (e) => { if(e.key === 'Enter') initPlayground(); });

    if (!$('#panel-play').hidden) initPlayground();

  })();
  </script>
</body>
</html>
